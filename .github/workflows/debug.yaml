---
name: Debug
"on":
  workflow_call:
  push:
  pull_request:
    branches:
      - main

jobs:

  print-context:
    runs-on: ubuntu-20.04
    steps:
      - uses: crazy-max/ghaction-dump-context@v1.2.0

      - uses: actions/checkout@v2.4.0
        with:
          ref: main
          # Get a couple of previous commits to trace back to the start of the PR.
          fetch-depth: 10
      - name: List all branches
        run: |
          git branch --all
      - name: List previous commits
        run: |
          git log --decorate=full --oneline
      - name: Extract release commit
        id: get_release_commit
        run: |
          echo "::set-output name=tagged_sha::$(
          git log --all --grep='\[changelog\] Release v${{
          steps.get_version.outputs.tagged_version }}' | head -1 | cut -d ' ' -f 2 )"
      - name: Print first commit SHA
        run: |
          echo "${{ steps.get_release_commit.outputs.tagged_sha }}"
      - name: Checkout first commit
        run: |
          git checkout ${{ steps.get_release_commit.outputs.tagged_sha }}
      - name: Extract version
        id: get_version
        run: |
          echo "::set-output name=tagged_version::$( grep "current_version = " ./.bumpversion.cfg | cut -d ' ' -f 3 )"
      - name: Print version
        run: |
